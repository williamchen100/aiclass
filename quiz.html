<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>æ—¥æ–‡å–®å­—æ¸¬é©—</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
   <style>
       body {
           font-family: 'Inter', 'Noto Sans TC', 'Noto Sans JP', sans-serif;
           background-color: #f0f4f8; /* æŸ”å’Œçš„èƒŒæ™¯è‰² */
       }
       .main-container {
           max-width: 600px;
           margin: auto;
       }
       .jp-font {
           font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
       }
       /* æŒ‰éˆ•æ‡¸åœæ•ˆæœ */
       .btn-hover-effect {
           transition: transform 0.2s ease, box-shadow 0.2s ease;
       }
       .btn-hover-effect:hover {
           transform: translateY(-3px);
           box-shadow: 0 4px 12px rgba(0,0,0,0.15);
       }
   </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

   <div class="main-container w-full">
       <!-- é›£åº¦é¸æ“‡ç•«é¢ -->
       <div id="start-screen" class="w-full bg-white rounded-2xl shadow-lg p-6 md:p-8 text-center">
           <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">æ—¥æ–‡å–®å­—æ¸¬é©—</h1>
           <p class="text-slate-500 mb-8">è«‹é¸æ“‡æ¸¬é©—é›£åº¦</p>
           <div id="difficulty-buttons" class="grid grid-cols-1 gap-4">
               <!-- é›£åº¦æŒ‰éˆ• -->
           </div>
       </div>

       <!-- æ¸¬é©—ç•«é¢ (é è¨­éš±è—) -->
       <div id="quiz-container" class="hidden w-full bg-white rounded-2xl shadow-lg p-6 md:p-8 transition-all duration-500">
           
           <div class="flex justify-between items-center border-b pb-4 mb-6">
               <h1 id="quiz-title" class="text-xl md:text-2xl font-bold text-slate-800"></h1>
               <div id="score" class="text-lg font-semibold bg-blue-500 text-white px-4 py-2 rounded-lg shadow">åˆ†æ•¸: 0</div>
           </div>

           <div id="quiz-content">
               <div class="mb-6 text-center">
                   <p class="text-slate-600 mb-2 text-lg">è«‹é¸æ“‡ä»¥ä¸‹æ—¥æ–‡å–®å­—çš„æ­£ç¢ºæ„æ€ï¼š</p>
                   <h2 id="question" class="jp-font text-5xl md:text-6xl font-bold text-blue-600 my-4 p-4 bg-blue-50 rounded-lg"></h2>
               </div>
               <div id="options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
               <div id="result" class="mt-6 text-center text-2xl font-bold h-8"></div>
           </div>

           <div id="final-result" class="hidden text-center py-10">
               <h2 class="text-3xl font-bold text-slate-800 mb-4">æ¸¬é©—çµæŸï¼</h2>
               <p id="final-score" class="text-2xl text-slate-600 mb-6"></p>
               <div class="space-y-4">
                   <button id="review-button" class="hidden w-full bg-purple-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-purple-600 transition-colors shadow-md text-lg btn-hover-effect">
                       è¤‡ç¿’éŒ¯èª¤å–®å­—
                   </button>
                   <button id="restart-button" class="w-full bg-green-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-600 transition-colors shadow-md text-lg btn-hover-effect">
                       è¿”å›é¸æ“‡é›£åº¦
                   </button>
               </div>
           </div>
           
           <div class="mt-8 flex justify-between items-center">
                <button id="back-button" class="bg-slate-300 text-slate-800 font-bold py-2 px-6 rounded-lg hover:bg-slate-400 transition-colors text-base">
                   â† è¿”å›
               </button>
               <button id="next-button" class="hidden bg-blue-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-600 transition-colors shadow-md text-lg">
                   ä¸‹ä¸€é¡Œ
               </button>
           </div>
       </div>
   </div>

   <script>
       // --- æ¸¬é©—è³‡æ–™åº« ---
       const quizDatabase = {
           N5: {
               name: 'å…¥é–€ç´š (N5)', color: 'bg-green-500', hover: 'hover:bg-green-600',
               data: [
                   { question: 'çŒ«', options: ['ç‹—', 'é³¥', 'è²“', 'é­š'], answer: 'è²“' }, { question: 'é£Ÿã¹ã‚‹', options: ['å–', 'åƒ', 'çœ‹', 'è½'], answer: 'åƒ' }, { question: 'å¤§ãã„', options: ['å¤§çš„', 'å°çš„', 'é«˜çš„', 'ä½çš„'], answer: 'å¤§çš„' }, { question: 'å­¦æ ¡', options: ['é†«é™¢', 'è»Šç«™', 'å­¸æ ¡', 'å…¬åœ’'], answer: 'å­¸æ ¡' }, { question: 'é›»è»Š', options: ['é£›æ©Ÿ', 'é›»è»Š', 'å…¬è»Š', 'è…³è¸è»Š'], answer: 'é›»è»Š' }, { question: 'æ–°ã—ã„', options: ['èˆŠçš„', 'æ˜‚è²´çš„', 'ä¾¿å®œçš„', 'æ–°çš„'], answer: 'æ–°çš„' }, { question: 'èª­ã‚€', options: ['å¯«', 'èªª', 'è®€', 'è·‘'], answer: 'è®€' }, { question: 'å¤©æ°—', options: ['æ™‚é–“', 'å¤©æ°£', 'é‡‘éŒ¢', 'å¥åº·'], answer: 'å¤©æ°£' }, { question: 'å‹é”', options: ['å®¶äºº', 'è€å¸«', 'æœ‹å‹', 'åŒäº‹'], answer: 'æœ‹å‹' }, { question: 'æ˜ ç”»', options: ['éŸ³æ¨‚', 'é›»è¦–', 'éŠæˆ²', 'é›»å½±'], answer: 'é›»å½±' }
               ]
           },
           N4: {
               name: 'åŸºç¤ç´š (N4)', color: 'bg-blue-500', hover: 'hover:bg-blue-600',
               data: [
                   { question: 'éƒ¨å±‹', options: ['å»šæˆ¿', 'åº­é™¢', 'æˆ¿é–“', 'å»æ‰€'], answer: 'æˆ¿é–“' }, { question: 'æ•™ãˆã‚‹', options: ['å­¸ç¿’', 'æ•™å°', 'å¿˜è¨˜', 'è©¢å•'], answer: 'æ•™å°' }, { question: 'ä¾¿åˆ©', options: ['å›°é›£', 'éº»ç…©', 'æ˜‚è²´', 'æ–¹ä¾¿'], answer: 'æ–¹ä¾¿' }, { question: 'æ­Œã†', options: ['è·³èˆ', 'ç•«ç•«', 'å”±æ­Œ', 'èµ°è·¯'], answer: 'å”±æ­Œ' }, { question: 'æ—…è¡Œ', options: ['æœƒè­°', 'æ´¾å°', 'é‹å‹•', 'æ—…è¡Œ'], answer: 'æ—…è¡Œ' },
               ]
           },
           N3: {
               name: 'é€²éšç´š (N3)', color: 'bg-yellow-500', hover: 'hover:bg-yellow-600',
               data: [
                   { question: 'è¤‡é›‘', options: ['å–®ç´”', 'è¤‡é›œ', 'æ¸…æ¥š', 'å›°é›£'], answer: 'è¤‡é›œ' }, { question: 'æƒ…å ±', options: ['æ„Ÿæƒ…', 'æ„è¦‹', 'çŸ¥è­˜', 'æƒ…å ±'], answer: 'æƒ…å ±' }, { question: 'é‹å‹•', options: ['è®€æ›¸', 'ä¼‘æ¯', 'å·¥ä½œ', 'é‹å‹•'], answer: 'é‹å‹•' }, { question: 'èª¬æ˜', options: ['æå•', 'èªªæ˜', 'åå°', 'åŒæ„'], answer: 'èªªæ˜' }, { question: 'ç¶šã‘ã‚‹', options: ['é–‹å§‹', 'çµæŸ', 'ç¹¼çºŒ', 'æš«åœ'], answer: 'ç¹¼çºŒ' },
               ]
           },
           N2: {
               name: 'ä¸­é«˜ç´š (N2)', color: 'bg-orange-500', hover: 'hover:bg-orange-600',
               data: [
                   { question: 'è­°è«–', options: ['é»˜èª', 'è¨è«–', 'æ¼”è¬›', 'å ±å‘Š'], answer: 'è¨è«–' }, { question: 'ç™ºå±•', options: ['è¡°é€€', 'åœæ»¯', 'ç™¼å±•', 'æ”¹é©'], answer: 'ç™¼å±•' }, { question: 'å½±éŸ¿', options: ['çµæœ', 'åŸå› ', 'å½±éŸ¿', 'éç¨‹'], answer: 'å½±éŸ¿' }, { question: 'æ„è­˜', options: ['æ½›æ„è­˜', 'å¤¢å¢ƒ', 'ç¾å¯¦', 'æ„è­˜'], answer: 'æ„è­˜' }, { question: 'è§£æ±º', options: ['æå‡º', 'åˆ†æ', 'è§£æ±º', 'æ”¾æ£„'], answer: 'è§£æ±º' },
               ]
           },
           N1: {
               name: 'æµæš¢ç´š (N1)', color: 'bg-red-500', hover: 'hover:bg-red-600',
               data: [
                   { question: 'å·§å¦™', options: ['ç¬¨æ‹™', 'æ™®é€š', 'å·§å¦™', 'å›°é›£'], answer: 'å·§å¦™' }, { question: 'å“²å­¦', options: ['ç§‘å­¸', 'æ–‡å­¸', 'å“²å­¸', 'æ­·å²'], answer: 'å“²å­¸' }, { question: 'æ™®éçš„', options: ['ç‰¹æ®Šçš„', 'å€‹åˆ¥çš„', 'æ™®éçš„', 'ç¨€æœ‰çš„'], answer: 'æ™®éçš„' }, { question: 'æ¦‚å¿µ', options: ['å¯¦é«”', 'æ€æƒ³', 'æ¦‚å¿µ', 'ç¾è±¡'], answer: 'æ¦‚å¿µ' }, { question: 'åˆ†æ', options: ['ç¶œåˆ', 'æ„Ÿè¦º', 'ç›´è¦º', 'åˆ†æ'], answer: 'åˆ†æ' },
               ]
           }
       };

       // --- DOM å…ƒç´  ---
       const startScreen = document.getElementById('start-screen');
       const difficultyButtonsContainer = document.getElementById('difficulty-buttons');
       const quizContainer = document.getElementById('quiz-container');
       const quizTitleElement = document.getElementById('quiz-title');
       const scoreElement = document.getElementById('score');
       const questionElement = document.getElementById('question');
       const optionsElement = document.getElementById('options');
       const resultElement = document.getElementById('result');
       const nextButton = document.getElementById('next-button');
       const backButton = document.getElementById('back-button');
       const quizContent = document.getElementById('quiz-content');
       const finalResultElement = document.getElementById('final-result');
       const finalScoreElement = document.getElementById('final-score');
       const restartButton = document.getElementById('restart-button');
       const reviewButton = document.getElementById('review-button');

       // --- è®Šæ•¸ ---
       let currentQuestionIndex = 0;
       let score = 0;
       let currentQuizData = [];
       let mistakeBank = []; // éŒ¯èª¤å–®å­—åº«
       let isReviewing = false; // æ˜¯å¦æ­£åœ¨è¤‡ç¿’æ¨¡å¼

       // --- å‡½å¼ ---
       
       function showStartScreen() {
           startScreen.classList.remove('hidden');
           quizContainer.classList.add('hidden');
           setupDifficultyButtons();
       }

       function setupDifficultyButtons() {
           difficultyButtonsContainer.innerHTML = '';
           for (const level in quizDatabase) {
               const levelInfo = quizDatabase[level];
               const button = document.createElement('button');
               button.textContent = levelInfo.name;
               button.className = `w-full text-white font-bold py-4 px-4 rounded-lg text-xl btn-hover-effect ${levelInfo.color} ${levelInfo.hover}`;
               button.onclick = () => startQuiz(level);
               difficultyButtonsContainer.appendChild(button);
           }
       }

       function shuffleArray(array) {
           for (let i = array.length - 1; i > 0; i--) {
               const j = Math.floor(Math.random() * (i + 1));
               [array[i], array[j]] = [array[j], array[i]];
           }
       }

       function startQuiz(level) {
           isReviewing = false;
           currentQuestionIndex = 0;
           score = 0;
           const levelInfo = quizDatabase[level];
           
           currentQuizData = [...levelInfo.data];
           shuffleArray(currentQuizData);

           startScreen.classList.add('hidden');
           quizContainer.classList.remove('hidden');
           quizContent.classList.remove('hidden');
           finalResultElement.classList.add('hidden');
           quizTitleElement.textContent = `æ¸¬é©— (${levelInfo.name})`;
           scoreElement.textContent = `åˆ†æ•¸: 0`;
           backButton.classList.remove('hidden');
           
           loadQuestion();
       }

       function startReviewQuiz() {
           if (mistakeBank.length === 0) {
               alert("æ²’æœ‰éŒ¯èª¤çš„å–®å­—å¯ä»¥è¤‡ç¿’ï¼");
               return;
           }
           isReviewing = true;
           currentQuestionIndex = 0;
           score = 0;
           
           currentQuizData = [...mistakeBank]; // å¾éŒ¯èª¤åº«ä¸­è¼‰å…¥é¡Œç›®
           shuffleArray(currentQuizData);

           startScreen.classList.add('hidden');
           quizContainer.classList.remove('hidden');
           quizContent.classList.remove('hidden');
           finalResultElement.classList.add('hidden');
           quizTitleElement.textContent = 'éŒ¯èª¤å–®å­—è¤‡ç¿’';
           scoreElement.textContent = `åˆ†æ•¸: 0`;
           backButton.classList.remove('hidden');

           loadQuestion();
       }


       function loadQuestion() {
           resultElement.textContent = '';
           resultElement.className = 'mt-6 text-center text-2xl font-bold h-8';
           optionsElement.innerHTML = '';
           nextButton.classList.add('hidden');

           const currentQuestion = currentQuizData[currentQuestionIndex];
           questionElement.textContent = currentQuestion.question;

           const shuffledOptions = [...currentQuestion.options];
           shuffleArray(shuffledOptions);

           shuffledOptions.forEach(option => {
               const button = document.createElement('button');
               button.textContent = option;
               button.className = "w-full bg-slate-200 text-slate-700 font-medium py-3 px-4 rounded-lg hover:bg-blue-200 hover:text-blue-800 transition-all duration-200 text-lg";
               button.onclick = () => selectAnswer(option, button);
               optionsElement.appendChild(button);
           });
       }
       
       function selectAnswer(selectedOption, selectedButton) {
           const currentQuestion = currentQuizData[currentQuestionIndex];
           const isCorrect = selectedOption === currentQuestion.answer;

           Array.from(optionsElement.children).forEach(btn => {
               btn.disabled = true;
               if (btn.textContent === currentQuestion.answer) {
                   btn.className = "w-full bg-green-500 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 text-lg";
               }
           });

           if (isCorrect) {
               score++;
               resultElement.textContent = 'æ­£è§£ï¼ğŸ‰';
               resultElement.classList.add('text-green-500');
               selectedButton.className = "w-full bg-green-500 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 text-lg";
               
               // å¦‚æœåœ¨è¤‡ç¿’æ¨¡å¼ç­”å°ï¼Œå°±å¾éŒ¯èª¤åº«ä¸­ç§»é™¤
               if (isReviewing) {
                   mistakeBank = mistakeBank.filter(q => q.question !== currentQuestion.question);
               }
           } else {
               resultElement.textContent = 'æ®‹å¿µ...';
               resultElement.classList.add('text-red-500');
               selectedButton.className = "w-full bg-red-500 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 text-lg";
               
               // å¦‚æœç­”éŒ¯ï¼Œä¸”é¡Œç›®ä¸é‡è¤‡ï¼Œå°±åŠ å…¥éŒ¯èª¤åº«
               if (!mistakeBank.some(q => q.question === currentQuestion.question)) {
                   mistakeBank.push(currentQuestion);
               }
           }
           
           scoreElement.textContent = `åˆ†æ•¸: ${score}`;
           nextButton.classList.remove('hidden');
       }

       function showFinalScore() {
           quizContent.classList.add('hidden');
           nextButton.classList.add('hidden');
           backButton.classList.add('hidden');
           finalResultElement.classList.remove('hidden');
           finalScoreElement.textContent = `æ‚¨ç­”å°äº† ${score} / ${currentQuizData.length} é¡Œï¼`;
           
           // æ ¹æ“šéŒ¯èª¤åº«ä¸­æ˜¯å¦æœ‰å–®å­—ï¼Œæ±ºå®šæ˜¯å¦é¡¯ç¤ºè¤‡ç¿’æŒ‰éˆ•
           if (mistakeBank.length > 0) {
               reviewButton.classList.remove('hidden');
               reviewButton.textContent = `è¤‡ç¿’éŒ¯èª¤å–®å­— (${mistakeBank.length})`;
           } else {
               reviewButton.classList.add('hidden');
           }
       }

       // --- äº‹ä»¶ç›£è½ ---
       nextButton.addEventListener('click', () => {
           currentQuestionIndex++;
           if (currentQuestionIndex < currentQuizData.length) {
               loadQuestion();
           } else {
               showFinalScore();
           }
       });
       
       reviewButton.addEventListener('click', startReviewQuiz);
       backButton.addEventListener('click', showStartScreen);
       restartButton.addEventListener('click', showStartScreen);

       // --- åˆå§‹å•Ÿå‹• ---
       window.onload = showStartScreen;

   </script>
</body>
</html>